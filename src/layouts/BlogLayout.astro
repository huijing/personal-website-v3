---
import BaseLayout from "./BaseLayout.astro";
import FormattedDate from "@/components/FormattedDate.astro";
import { slugify } from "@/utils";
import "@/styles/posts.css";

const {
  title,
  date,
  tags,
  noindex,
  og_image,
  external_url,
  hastweet,
  hascaniuse,
  hascodepen,
  description,
} = Astro.props;
const dateObj = new Date(date);
const canonicalURL = external_url ? external_url : new URL(Astro.url.pathname, Astro.site).href;
---

<BaseLayout
  title={title}
  description={description}
  ogImageUrl={og_image}
  noindex={noindex}
  ogType="article"
  canonicalURL={canonicalURL}
>
  <main>
    <article>
      <header class="post-header">
        <span class="post-meta"><FormattedDate date={dateObj} /></span>
        <h1 class="post-header__title">{title}</h1>
      </header>

      <div class="post-content">
        <slot />
        <p class="post-meta">
          {
            tags && tags.length === 1 && (
              <span class="icon icon--tag">
                <svg viewBox="0 0 544 512">
                  <path d="M496,32H384c-26.4,0-63.273,15.273-81.941,33.941L113.941,254.059c-18.667,18.667-18.667,49.214,0,67.882l140.118,140.115 c18.667,18.668,49.214,18.668,67.882,0l188.115-188.115C528.727,255.273,544,218.4,544,192V80C544,53.6,522.4,32,496,32z M432,192 c-26.51,0-48-21.49-48-48s21.49-48,48-48s48,21.49,48,48S458.51,192,432,192z" />
                </svg>
              </span>
            )
          }
          {
            tags && tags.length > 1 && (
              <span class="icon icon--tags">
                <svg viewBox="0 0 544 512">
                  <path d="M496,32H384c-26.4,0-63.273,15.273-81.941,33.941L113.941,254.059c-18.667,18.667-18.667,49.214,0,67.882l140.118,140.116 c18.667,18.668,49.214,18.668,67.882,0l188.116-188.116C528.727,255.273,544,218.4,544,192V80C544,53.6,522.4,32,496,32z M432,192 c-26.51,0-48-21.49-48-48s21.49-48,48-48s48,21.49,48,48S458.51,192,432,192z M43.313,299.312l171.189,171.189 c-18.132,9.58-41.231,6.77-56.443-8.444L17.941,321.941c-18.667-18.668-18.667-49.215,0-67.882L206.059,65.941 C224.727,47.273,261.6,32,288,32L43.313,276.686C37.091,282.909,37.091,293.09,43.313,299.312z" />
                </svg>
              </span>
            )
          }
          {
            tags &&
              tags.map((tag: string, i: number) => (
                <>
                  {i > 0 ? ", " : ""}
                  <a class="post-content__tag small" href={`/tags/${slugify(tag)}/`}>
                    {tag}
                  </a>
                </>
              ))
          }
        </p>
      </div>
    </article>
  </main>
</BaseLayout>

{hastweet && <script async src="/js/twitter.js" charset="utf-8" />}
{hascaniuse && <script is:inline src="/js/caniuse.js" />}
{hascodepen && <script async src="/js/codepen.js" />}
